# JQ Transformations for Swagger/OpenAPI Specification

This document describes the JQ transformations used to adapt the `swagger.json` OpenAPI specification for different purposes: the developer documentation site and Azure API Management (APIM).

The starting point for both transformations is the `swagger.json` file generated by the running application, which can be fetched from `http://localhost:5090/swagger/v1/swagger.json`.

> [!NOTE]
> You will need `jq` from https://jqlang.org/ to apply these transformations.
> If executing jq in PowerShell, please use version 6 or later (See https://github.com/jqlang/jq/issues/2351)



### Key changes for docs.altinn.no (`transform.jq`):
- **OpenAPI Version**: Sets the version to `3.0.3`.
- **Security**: Removes all security-related definitions (`security` and `securitySchemes`), as authentication is handled externally.
- **Path Prefix**: Removes the base `/notifications/api/v1` prefix from all API paths to simplify them.
- **Tag Consolidation**:
  - Merges the `FutureOrders` and `Shipment` tags into a single `Orders` tag
  - Converts `InstantOrders` to `Instant Orders` for better readability
- **Tag Organization**: Creates organized sections with descriptions:
  - `Deprecated`: Legacy endpoints (still supported, use `/future/*` endpoints instead)
  - `Order`: Create notifications (queued processing)
  - `Status`: Get status/updates for notifications already ordered
  - `Instant Orders`: Create and send instant notifications to single recipients
- **Endpoint Categorization**: Assigns appropriate tags to all deprecated and future endpoints
- **Server URL**: Removes the local development server URL and updates the production URL to include the correct base path (`/notifications/api/v1`).

### Key changes for APIM (`transform-apim.jq`):
- **OpenAPI Version**: Sets the version to `3.0.1`.
- **Server Info**: Removes all `servers` definitions, as APIM manages the base URLs.
- **Security**: Removes all security-related definitions (`security` and `securitySchemes`).
- **Path Prefix**: Removes the `/notifications/api/v1` base prefix from all API paths.
- **Tag Consolidation**:
  - Merges the `FutureOrders` and `Shipment` tags into `Orders`
  - Converts `InstantOrders` to `Instant Orders` for better readability
- **Simplified Organization**: Unlike the docs transform, this does not create additional tag descriptions or categorize deprecated endpoints, keeping the structure simple.


## How to apply the transformation:
Get the most recent `swagger.json` from a locally running instance of the Notifications application:

```bash
curl http://localhost:5090/swagger/v1/swagger.json -o localhost.json
```

Then apply the transformation using `jq`:

```bash
jq -f transform.jq localhost.json > altinn-notifications-v1.json
```

