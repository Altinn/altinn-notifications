meta {
  name: Send Instant Email
  type: http
  seq: 1
}

post {
  url: {{host}}/notifications/api/v1/future/orders/instant/email
  body: json
  auth: inherit
}

body:json {
  {
    "idempotencyId": "{{random_idempotency_id}}",
    "sendersReference": "demo-email-{{senders_reference_guid}}",
    "recipientEmail": {
      "emailAddress": "{{process.env.TESTDATA_MY_EMAIL}}",
      "emailSettings": {
        "subject": "(DEMO) Instant Email Demo Test",
        "body": "(DEMO) Instant email test (Env.: {{Environment}} - Ref: {{random_idempotency_id}})",
        "contentType": "Plain"
      }
    }
  }
}

script:post-response {
  if (res.status === 201 && res.body && res.body.notification && res.body.notification.shipmentId) {
    bru.setVar("mostRecentShipmentId", res.body.notification.shipmentId);
  }
}

docs {
  Creates and sends an instant email notification to a single recipient for demo purposes.
  The request is processed immediately and the email is sent without delay.

  Required environment variables:
  - TESTDATA_MY_EMAIL: Your email address for testing

  The idempotencyId ensures the same notification is not sent multiple times
  if the request is repeated.

  Available contentType values: "Plain" or "Html"

  This request automatically captures the shipmentId from the response and stores it
  in the 'mostRecentShipmentId' variable for use in subsequent requests.
}
